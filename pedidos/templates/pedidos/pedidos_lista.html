{% extends "pedidos/base.html" %}
{% block content %}
<div class="container my-4">

  <h2>Lista de Pedidos</h2>

  <!-- Form para borrado masivo -->
  <form method="post" action="{% url 'pedidos:pedido_eliminar_masivo' %}">
    {% csrf_token %}
    <button type="submit"
            class="btn btn-danger mb-3"
            onclick="return confirm('¿Eliminar todos los seleccionados?');">
      🗑️ Eliminar seleccionados
    </button>

    <table class="table table-striped">
      <thead>
        <tr>
          <th><input type="checkbox" id="select-all"></th>
          <th>Fecha inicio</th>
          <th>Fecha fin</th>
          <th>Empresa</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for p in pedidos %}
        <tr>
          <td>
            <input type="checkbox"
                   name="selected_ids"
                   value="{{ p.pk }}"
                   class="select-checkbox">
          </td>
          <td>{{ p.fecha_inicio|date:"d/m/Y" }}</td>
          <td>{{ p.fecha_fin|date:"d/m/Y"|default:"—" }}</td>
          <td>{{ p.empresa }}</td>
          <td>
            <!-- Editar -->
            <a href="{% url 'pedidos:pedido_editar' p.pk %}"
               class="btn btn-sm btn-warning">
              ✏️
            </a>
            <!-- Eliminar individual -->
            <form method="post"
                  action="{% url 'pedidos:pedido_eliminar' p.pk %}"
                  style="display:inline"
                  onsubmit="return confirm('¿Eliminar este pedido?');">
              {% csrf_token %}
              <button class="btn btn-sm btn-danger">🗑️</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </form>

</div>
{% endblock %}

{% block scripts %}
  {{ block.super }}
  <script>
    // Checkbox "Seleccionar todos"
    document.addEventListener('DOMContentLoaded', () => {
      const selectAll = document.getElementById('select-all');
      selectAll && selectAll.addEventListener('change', () => {
        document.querySelectorAll('.select-checkbox').forEach(cb => {
          cb.checked = selectAll.checked;
        });
      });
    });
  </script>
{% endblock %}
{% block styles %}
  {{ block.super }}
  <style>
    /* Estilos específicos para la lista de pedidos */
    .table th, .table td {
      vertical-align: middle;
    }
    .btn {
      margin-right: 5px;
    }
  </style>
{% endblock %}