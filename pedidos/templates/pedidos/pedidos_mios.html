{% extends "pedidos/base.html" %}
{% load static %}

{% block title %}Mis pedidos · Innovations Tours{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{% static 'pedidos/css/styles.css' %}">
{% endblock %}
{% block content %}
<div class="container">
  <h2 class="mb-4">Mis pedidos</h2>

  {% if pedidos %}
    <div class="table-responsive">
      <table class="table table-striped">
        <thead class="table-dark">
          <tr>
            <th>Fecha inicio</th><th>Fecha Fin</th><th>Excursión</th><th>Empresa</th>
            <th>Lugar E/R</th><th>Maletas<br>(Pax / Guía)</th><th>Estado</th><th>Notas</th>
            <th>Acciones</th>

          </tr>
        </thead>
        <tbody>
          {% for p in pedidos %}
          <tr>
            <td>{{ p.fecha_inicio|date:"d/m/Y" }}</td>
            <td>{{ p.fecha_fin|date:"d/m/Y"|default:"—" }}</td>
            <td>{{ p.excursion|default:"—" }}</td>
            <td>{{ p.empresa }}</td>
            <td>{{ p.lugar_entrega }} / {{ p.lugar_recogida|default:"—" }}</td>
            <td>
              {% for m in p.maletas.all %}
                <div>{{ m.cantidad_pax }} pax / {{ m.guia }}</div>
              {% empty %}
                —
              {% endfor %}
            </td>
            <td>
              <button
                      class="btn
                        {% if p.estado == 'pendiente_pago' %}
                          btn-outline-secondary
                        {% elif p.estado == 'pagado' %}
                          btn-success
                        {% elif p.estado == 'aprobado' %}
                          btn-primary
                        {% elif p.estado == 'entregado' %}
                          btn-info text-dark
                        {% elif p.estado == 'recogido' %}
                          btn-dark
                        {% else %}
                          btn-outline-secondary
                        {% endif %}
                      btn-estado"
                      data-pk="{{ p.pk }}">
                      {{ p.get_estado_display }}
                    </button></td>
            <td>{{ p.notas|default:"—" }}</td>
            <td>
              <a class="btn btn-sm btn-warning"
                 href="{% url 'pedidos:pedido_editar_cliente' p.pk %}">✏️</a>
            </td>
          </tr>
          
          {% endfor %}
        </tbody>
      </table>
    </div>

    {# ---------- FAB “+” ---------- #}
{# FAB que abre el modal #}
<a href="#" class="btn btn-primary btn-lg rounded-circle fab"
   data-bs-toggle="modal"
   data-bs-target="#modalNuevoPedido"
   title="Crear nuevo pedido">+</a>

<div class="modal fade" id="modalNuevoPedido" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Nuevo pedido</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body p-0" style="height:80vh;">
        <iframe src="{% url 'pedidos:pedido_nuevo_cliente' %}?embed=1"
                class="w-100 h-100 border-0"
                loading="lazy"></iframe>
      </div>
    </div>
  </div>
</div>
  {% else %}
    <div class="alert alert-info text-center">
      Aún no tienes pedidos registrados.
      <a href="{% url 'pedidos:pedido_nuevo_cliente' %}" class="btn btn-primary mt-3">
        ➕ Crear mi primer pedido
      </a>
    </div>
  {% endif %}
</div>
{% endblock %}
