{# templates/pedidos/_pedido_form.html #}
{% load static %}

<form method="POST" id="pedido-form">
  {% csrf_token %}
  {{ form.as_p }}

  <h5 class="mt-4 mb-3">Servicios</h5>
  {{ formset.management_form }}
  <div id="servicios-container">
    {% for sf in formset %}
      <div class="card mb-3 p-3 position-relative">
        {{ sf.id }}
        <button type="button"
                class="btn-close eliminar-servicio position-absolute top-0 end-0"
                aria-label="Eliminar servicio"></button>

        <div class="row g-3">
          <div class="col-md-4">
            <label for="{{ sf.excursion.id_for_label }}" class="form-label">
              Excursión <span class="text-danger">*</span>
            </label>
            {{ sf.excursion }}
          </div>
          <div class="col-md-2">
            <label for="{{ sf.pax.id_for_label }}" class="form-label">
              Pax <span class="text-danger">*</span>
            </label>
            {{ sf.pax }}
          </div>
          <div class="col-md-2">
            <label for="{{ sf.emisores.id_for_label }}" class="form-label">
              Emisores <span class="text-danger">*</span>
            </label>
            {{ sf.emisores }}
          </div>
          <div class="col-md-4">
            <label for="{{ sf.lugar_entrega.id_for_label }}" class="form-label">
              Lugar de entrega
            </label>
            {{ sf.lugar_entrega }}
          </div>
        </div>

        <div class="mt-2">
          <label for="{{ sf.bono.id_for_label }}" class="form-label">
            Bono
          </label>
          {{ sf.bono }}
        </div>

        {{ sf.DELETE }} {# checkbox hidden del formset #}
      </div>
    {% endfor %}
  </div>

  <div class="text-center mb-4">
    <button type="button" id="add-servicio" class="btn btn-outline-secondary">
      + Añadir servicio
    </button>
  </div>

  <button type="submit" class="btn btn-primary w-100">
    {% if es_edicion %}Actualizar{% else %}Guardar pedido{% endif %}
  </button>
</form>

{% block scripts %}
  {{ block.super }}
  <script src="{% static 'pedidos/js/pedido_form.js' %}"></script>
{% endblock %}
