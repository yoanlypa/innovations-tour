{% extends 'pedidos/base.html' %}
{% load static %}

{% block content %}
<style>
  .form-card {
    max-width: 500px;
    margin: 0 auto;
    border-radius: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.1);
    padding: 2rem;
    background: #fff;
  }
  .form-title {
    font-size: 1.5rem;
    color: #005dab;
    text-align: center;
    margin-bottom: 1rem;
  }
  .form-footer {
    text-align: center;
    margin-top: 1rem;
  }
  .form-footer a {
    text-decoration: underline;
    cursor: pointer;
  }
</style>

<div class="form-card">
  {% if login_form.errors or register_form.errors %}
    <div class="alert alert-danger">Por favor revisa los errores en el formulario.</div>
  {% endif %}

  {% if mode == 'register' %}
    <h2 class="form-title">Registro</h2>
    <form method="post">
      {% csrf_token %}
      {{ register_form.as_p }}
      <input type="hidden" name="mode" value="register">
      <button class="btn btn-primary w-100 mt-3">Crear cuenta</button>
    </form>
    <div class="form-footer">
      <span>¿Ya tienes cuenta?</span> <a onclick="cambiarModo('acceso')">Inicia sesión</a>
    </div>
  {% elif mode == 'reset' %}
    <h2 class="form-title">Recuperar Contraseña</h2>
    <form method="post">
      {% csrf_token %}
      <input type="email" name="email" class="form-control mb-3" placeholder="Tu correo" required>
      <input type="hidden" name="mode" value="reset">
      <button class="btn btn-primary w-100">Enviar enlace</button>
    </form>
    <div class="form-footer">
      <a onclick="cambiarModo('acceso')">Volver al login</a>
    </div>
  {% else %}
    <h2 class="form-title">Iniciar Sesión</h2>
    <form method="post">
      {% csrf_token %}
      {{ login_form.as_p }}
      <input type="hidden" name="mode" value="acceso">
      <button class="btn btn-primary w-100">Ingresar</button>
    </form>
    <div class="form-footer">
      <a onclick="cambiarModo('register')">Crear cuenta</a> | 
      <a onclick="cambiarModo('reset')">Olvidé mi contraseña</a>
    </div>
  {% endif %}
</div>

<script>
  function cambiarModo(modo) {
    const form = document.createElement('form');
    form.method = 'post';
    form.style.display = 'none';
    const csrf = document.querySelector('[name=csrfmiddlewaretoken]').cloneNode();
    const modeInput = document.createElement('input');
    modeInput.type = 'hidden';
    modeInput.name = 'mode';
    modeInput.value = modo;
    form.appendChild(csrf);
    form.appendChild(modeInput);
    document.body.appendChild(form);
    form.submit();
  }
</script>
{% endblock %}
