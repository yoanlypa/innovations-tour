{% extends 'base.html' %}
{% load static %}

{% block content %}
<h1>Tareas</h1>

<!-- Lista de tareas (cada tarea es un elemento clickable) -->
{% for tarea in tareas %}
<div 
    class="tarea-item {% if tarea.completada %}completada{% endif %}" 
    data-tarea-id="{{ tarea.id }}"
    style="cursor: pointer; padding: 10px; margin: 5px; border: 1px solid #ccc;"
>
    {{ tarea.titulo }} - Estado: <span class="estado-texto">{% if tarea.completada %}Realizada ✅{% else %}Pendiente ⚪{% endif %}</span>
</div>
{% endfor %}

<!-- Script integrado (cambia el estado al hacer clic en la tarea) -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // Función para cambiar el estado
    const cambiarEstado = async (tareaId) => {
        const url = `/tareas/cambiar-estado/${tareaId}/`;
        const csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;

        try {
            const response = await fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrftoken,
                    'Content-Type': 'application/json',
                },
            });
            
            const data = await response.json();
            const tareaElement = document.querySelector(`[data-tarea-id="${tareaId}"]`);
            const estadoTexto = tareaElement.querySelector('.estado-texto');

            if (data.completada) {
                tareaElement.classList.add('completada');
                estadoTexto.innerHTML = 'Realizada ✅';
            } else {
                tareaElement.classList.remove('completada');
                estadoTexto.innerHTML = 'Pendiente ⚪';
            }
        } catch (error) {
            console.error('Error:', error);
        }
    };

    // Evento click en las tareas
    document.querySelectorAll('.tarea-item').forEach(tarea => {
        tarea.addEventListener('click', (event) => {
            const tareaId = event.currentTarget.dataset.tareaId;  // Usar currentTarget para obtener el div padre
            cambiarEstado(tareaId);
        });
    });
});
</script>

{% endblock %}