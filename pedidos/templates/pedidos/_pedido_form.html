{% load static %}
{# templates/pedidos/_pedido_form.html #}
{# ✂️ Aquí NO debe haber etiqueta <form> ✂️ #}

{# —— errores globales —— #}
{% if form.non_field_errors %}
  <div class="alert alert-danger">
    {{ form.non_field_errors }}
  </div>
{% endif %}

{# —— fecha de inicio + fecha fin —— #}
<div class="row">
  <div class="col-md-6 mb-3">
    <label for="{{ form.fecha_inicio.id_for_label }}" class="form-label">
      Fecha de inicio <span class="text-danger">*</span>
    </label>
    {{ form.fecha_inicio }}
    {% if form.fecha_inicio.errors %}
      <div class="invalid-feedback d-block">
        {{ form.fecha_inicio.errors.0 }}
      </div>
    {% endif %}
  </div>
  <div class="col-md-6 mb-3">
    <label for="{{ form.fecha_fin.id_for_label }}" class="form-label">
      Fecha fin
    </label>
    {{ form.fecha_fin }}
    {% if form.fecha_fin.errors %}
      <div class="invalid-feedback d-block">
        {{ form.fecha_fin.errors.0 }}
      </div>
    {% endif %}
  </div>
</div>

{# —— empresa, excursión, estado —— #}
<div class="row">
  <div class="col-md-4 mb-3">
    <label for="{{ form.empresa.id_for_label }}" class="form-label">
      Empresa <span class="text-danger">*</span>
    </label>
    {{ form.empresa }}
    {% if form.empresa.errors %}
      <div class="invalid-feedback d-block">
        {{ form.empresa.errors.0 }}
      </div>
    {% endif %}
  </div>
  <div class="col-md-4 mb-3">
    <label for="{{ form.excursion.id_for_label }}" class="form-label">
      Excursión
    </label>
    {{ form.excursion }}
    {% if form.excursion.errors %}
      <div class="invalid-feedback d-block">
        {{ form.excursion.errors.0 }}
      </div>
    {% endif %}
  </div>
  <div class="col-md-4 mb-3">
    <label for="{{ form.estado_cliente.id_for_label }}" class="form-label">
      Estado <span class="text-danger">*</span>
    </label>
    {{ form.estado_cliente }}
    <small class="form-text text-muted">
      Si no ha pagado, elige “Pendiente”.
    </small>
    {% if form.estado_cliente.errors %}
      <div class="invalid-feedback d-block">
        {{ form.estado_cliente.errors.0 }}
      </div>
    {% endif %}
  </div>
</div>

{# —— lugares —— #}
<div class="row">
  <div class="col-md-6 mb-3">
    <label for="{{ form.lugar_entrega.id_for_label }}" class="form-label">
      Lugar de entrega
    </label>
    {{ form.lugar_entrega }}
    {% if form.lugar_entrega.errors %}
      <div class="invalid-feedback d-block">
        {{ form.lugar_entrega.errors.0 }}
      </div>
    {% endif %}
  </div>
  <div class="col-md-6 mb-3">
    <label for="{{ form.lugar_recogida.id_for_label }}" class="form-label">
      Lugar de recogida
    </label>
    {{ form.lugar_recogida }}
    {% if form.lugar_recogida.errors %}
      <div class="invalid-feedback d-block">
        {{ form.lugar_recogida.errors.0 }}
      </div>
    {% endif %}
  </div>
</div>

{# —— notas —— #}
<div class="mb-3">
  <label for="{{ form.notas.id_for_label }}" class="form-label">
    Notas
  </label>
  {{ form.notas }}
  {% if form.notas.errors %}
    <div class="invalid-feedback d-block">
      {{ form.notas.errors.0 }}
    </div>
  {% endif %}
</div>

{# —— maletas —— #}
<h5 class="mt-4 mb-3">Maletas</h5>
{{ formset.management_form }}
<div id="maletas-container">
  {% for mf in formset %}
    <div class="card mb-3 p-3 position-relative">
      <button type="button"
              class="btn-close position-absolute top-0 end-0 eliminar-maleta"
              aria-label="Eliminar"></button>
      <div class="row g-3">
        <div class="col-md-6">
          <label for="{{ mf.guia.id_for_label }}" class="form-label">
            Guía <span class="text-danger">*</span>
          </label>
          {{ mf.guia }}
          {% if mf.guia.errors %}
            <div class="invalid-feedback d-block">{{ mf.guia.errors.0 }}</div>
          {% endif %}
        </div>
        <div class="col-md-6">
          <label for="{{ mf.cantidad_pax.id_for_label }}" class="form-label">
            Pax <span class="text-danger">*</span>
          </label>
          {{ mf.cantidad_pax }}
          {% if mf.cantidad_pax.errors %}
            <div class="invalid-feedback d-block">{{ mf.cantidad_pax.errors.0 }}</div>
          {% endif %}
        </div>
      </div>
      <button type="button"
        name="remove_maleta"
        class="btn-close position-absolute top-0 end-0 eliminar-maleta"
        aria-label="Eliminar maleta"></button>
      <input type="checkbox"
             name="{{ formset.prefix }}-{{ forloop.counter0 }}-DELETE"
             id="id_{{ formset.prefix }}-{{ forloop.counter0 }}-DELETE"
             hidden>
    </div>
  {% endfor %}
</div>
<div class="text-center mb-4">
  <button type="button" id="add-maleta"
        name="add_maleta"
        class="btn btn-outline-secondary">
  + Añadir maleta
</button>
</div>

{# —— submit —— #}
<div class="text-center">
  <button type="submit" class="btn btn-primary px-5">
    {% if es_edicion %}Actualizar{% else %}Guardar pedido{% endif %}
  </button>
</div>
