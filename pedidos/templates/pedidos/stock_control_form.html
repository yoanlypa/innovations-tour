{% extends "pedidos/base.html" %}
{% load static %}

{% block content %}
<div class="container mt-5">
  <h2 class="mb-4">âž• Nuevo Control de Stock</h2>

  <form id="stock-form-standalone" method="post" action="{% url 'pedidos:agregar_stock' %}">
    {% csrf_token %}

    <!-- Selector de Pedido pagado -->
    <div class="mb-3">
      <label for="id_pedido" class="form-label">Pedido*</label>
      {{ form.pedido }}
    </div>

 

    <!-- Formset de Maletas -->
    <div class="border p-3 mb-4 rounded">
      <h5 class="mb-3">ðŸŽ’ GestiÃ³n de Maletas</h5>
      {{ formset.management_form }}
      <div id="maletas-container-standalone">
        {% for mform in formset %}
          <div class="maleta-form mb-3 p-2 border rounded">
            {{ mform.id }}
            <div class="row g-2">
              <div class="col-md-6">{{ mform.guia.label_tag }} {{ mform.guia }}</div>
              <div class="col-md-5">{{ mform.pax.label_tag }}  {{ mform.pax }}</div>
              <div class="col-md-1">{{ mform.DELETE.label_tag }} {{ mform.DELETE }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
      <button type="button" id="add-maleta-standalone" class="btn btn-secondary mt-2">
        âž• AÃ±adir Maleta
      </button>
    </div>

    <div class="text-end">
      <button type="submit" class="btn btn-success">ðŸ’¾ Guardar</button>
      <a href="{% url 'pedidos:stock_control' %}" class="btn btn-secondary">Cancelar</a>
    </div>
  </form>
</div>
{% endblock %}

{% block scripts %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
$(function() {
  // Clonar dinÃ¡micamente maletas en la vista standalone
  let formIndex = parseInt($('#id_form-TOTAL_FORMS').val(), 10);
  $('#add-maleta-standalone').click(function() {
    const $first = $('.maleta-form:first').clone();
    $first.find(':input').each(function() {
      const name = $(this).attr('name').replace('-0-', `-${formIndex}-`);
      $(this).attr('name', name).attr('id', 'id_' + name).val('');
    });
    $('#maletas-container-standalone').append($first);
    formIndex++;
    $('#id_form-TOTAL_FORMS').val(formIndex);
  });
});
</script>
{% endblock %}
